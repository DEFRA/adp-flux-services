apiVersion: authorization.azure.com/v1api20200801preview
kind: RoleAssignment
metadata:
  name: ${SUBSCRIPTION_NAME}-${DATABASE_SERVER_RG}-${SHARED_POSTGRES_SERVER_01}-${TEAM_NAMESPACE}-aso-pgdb-rbac
  namespace: flux-config
spec:
  owner:
    armId: /subscriptions/${SUBSCRIPTION_ID}/resourceGroups/${DATABASE_SERVER_RG}/providers/Microsoft.DBforPostgreSQL/flexibleServers/${SHARED_POSTGRES_SERVER_01}
  principalIdFromConfig:
    name: ${TEAM_NAMESPACE}-mi-credential
    key: principalId
  roleDefinitionReference:
    armId: /subscriptions/${SUBSCRIPTION_ID}/providers/Microsoft.Authorization/roleDefinitions/3fb74f7f-426d-5aaf-8a48-f1dd2b3e8585 # DEFRA ADP ASO PostgreSql Database Owner