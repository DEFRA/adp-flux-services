parameters:
  - name: publishFromFeature
    displayName: Publish from feature branch
    type: boolean
    default: false

trigger:
  batch: true
  branches:
    include:
      - 'main'
  paths:
    include:
      - common/dockerfile
    exclude:
      - services
      - common/scripts

pr:
  branches:
    include:  
      - main

pool:
  vmImage: 'ubuntu-latest'

resources:
  repositories:
    - repository: DEFRA-ADPPipelineCommon
      name: DEFRA/adp-pipeline-common
      endpoint: DEFRA
      type: github
      ref: refs/heads/jk/pg-db-access

extends:
  template: /pipelines/common-docker-image-publish.yaml@DEFRA-ADPPipelineCommon 
  parameters:
    sharedAcrConfig:
      name: 'ssvadpinfcr3401'
      serviceConnection: 'AZD-ADP-SSV3'
    dockerImageName: 'powershell-executor'
    dockerImageVersion: $(Build.BuildId)
    dockerFilePath: 'common/dockerfile/powershell-executor.Dockerfile'
    publishFromFeature: ${{ parameters.publishFromFeature }}